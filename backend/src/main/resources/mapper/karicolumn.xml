<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.KariColumnDao">

	<!-- 컬럼 생성 -->
	<insert id="insert" parameterType="karicolumn">
		INSERT INTO kari_column (column_id, title, position, team_id, project_id)
		VALUES (kari_column_seq.nextval, #{title},
			(SELECT NVL(MAX(position), 0) + 1 FROM kari_column WHERE team_id = #{teamId}),
			#{teamId}, #{projectId, jdbcType=INTEGER})
	</insert>

	<!-- 프로젝트별 컬럼 목록 -->
	<select id="listByProject" parameterType="int" resultType="karicolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM kari_column
		WHERE project_id = #{projectId}
		ORDER BY position ASC
	</select>

	<!-- 팀별 컬럼 목록 -->
	<select id="listByTeam" parameterType="int" resultType="karicolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM kari_column
		WHERE team_id = #{teamId}
		ORDER BY position ASC
	</select>

	<!-- 컬럼 목록 (전체 - 하위호환) -->
	<select id="list" resultType="karicolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM kari_column
		ORDER BY position ASC
	</select>

	<!-- 컬럼 상세 -->
	<select id="content" parameterType="int" resultType="karicolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM kari_column
		WHERE column_id = #{columnId}
	</select>

	<!-- 컬럼 수정 -->
	<update id="update" parameterType="karicolumn">
		UPDATE kari_column
		SET title = #{title}
		WHERE column_id = #{columnId}
	</update>

	<!-- 컬럼 삭제 -->
	<delete id="delete" parameterType="int">
		DELETE FROM kari_column WHERE column_id = #{columnId}
	</delete>

	<!-- 컬럼 위치 변경 -->
	<update id="updatePosition" parameterType="karicolumn">
		UPDATE kari_column
		SET position = #{position}
		WHERE column_id = #{columnId}
	</update>

</mapper>
