<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.FlowtaskColumnDao">

	<!-- 컬럼 생성 -->
	<insert id="insert" parameterType="flowtaskcolumn">
		INSERT INTO flowtask_column (column_id, title, position, team_id, project_id)
		VALUES (nextval('flowtask_column_seq'), #{title},
			(SELECT COALESCE(MAX(position), 0) + 1 FROM flowtask_column WHERE team_id = #{teamId}),
			#{teamId},
			<if test="projectId != 0">#{projectId}</if>
			<if test="projectId == 0">NULL</if>)
	</insert>

	<!-- 프로젝트별 컬럼 목록 -->
	<select id="listByProject" parameterType="int" resultType="flowtaskcolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM flowtask_column
		WHERE project_id = #{projectId}
		ORDER BY position ASC
	</select>

	<!-- 팀별 컬럼 목록 -->
	<select id="listByTeam" parameterType="int" resultType="flowtaskcolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM flowtask_column
		WHERE team_id = #{teamId}
		ORDER BY position ASC
	</select>

	<!-- 컬럼 목록 (전체 - 하위호환) -->
	<select id="list" resultType="flowtaskcolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM flowtask_column
		ORDER BY position ASC
	</select>

	<!-- 컬럼 상세 -->
	<select id="content" parameterType="int" resultType="flowtaskcolumn">
		SELECT column_id, title, position, team_id, project_id
		FROM flowtask_column
		WHERE column_id = #{columnId}
	</select>

	<!-- 컬럼 수정 -->
	<update id="update" parameterType="flowtaskcolumn">
		UPDATE flowtask_column
		SET title = #{title}
		WHERE column_id = #{columnId}
	</update>

	<!-- 컬럼 삭제 -->
	<delete id="delete" parameterType="int">
		DELETE FROM flowtask_column WHERE column_id = #{columnId}
	</delete>

	<!-- 컬럼 위치 변경 -->
	<update id="updatePosition" parameterType="flowtaskcolumn">
		UPDATE flowtask_column
		SET position = #{position}
		WHERE column_id = #{columnId}
	</update>

</mapper>
