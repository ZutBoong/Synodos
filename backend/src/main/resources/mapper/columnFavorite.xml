<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.dao.ColumnFavoriteDao">

    <!-- 즐겨찾기 추가 -->
    <insert id="insert" parameterType="columnFavorite">
        INSERT INTO flowtask_column_favorite (column_id, member_no, created_at)
        VALUES (#{columnId}, #{memberNo}, CURRENT_TIMESTAMP)
        ON CONFLICT (column_id, member_no) DO NOTHING
    </insert>

    <!-- 즐겨찾기 삭제 -->
    <delete id="delete">
        DELETE FROM flowtask_column_favorite
        WHERE column_id = #{columnId} AND member_no = #{memberNo}
    </delete>

    <!-- 멤버별 즐겨찾기 목록 (컬럼 정보 포함) -->
    <select id="listByMember" parameterType="int" resultType="columnFavorite">
        SELECT cf.column_id, cf.member_no, cf.created_at,
               c.title as column_title, c.position,
               c.team_id, t.team_name,
               c.project_id, p.project_name
        FROM flowtask_column_favorite cf
        JOIN flowtask_column c ON cf.column_id = c.column_id
        JOIN flowtask_team t ON c.team_id = t.team_id
        LEFT JOIN flowtask_project p ON c.project_id = p.project_id
        WHERE cf.member_no = #{memberNo}
        ORDER BY cf.created_at DESC
    </select>

    <!-- 특정 즐겨찾기 조회 -->
    <select id="findOne" resultType="columnFavorite">
        SELECT column_id, member_no, created_at
        FROM flowtask_column_favorite
        WHERE column_id = #{columnId} AND member_no = #{memberNo}
    </select>

    <!-- 멤버의 즐겨찾기 수 -->
    <select id="countByMember" parameterType="int" resultType="int">
        SELECT COUNT(*) FROM flowtask_column_favorite
        WHERE member_no = #{memberNo}
    </select>

</mapper>
